<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mlr3mbo">
<title>mlr3mbo • mlr3mbo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.2/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.2/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="mlr3mbo">
<meta property="og:description" content="mlr3mbo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mlr3mbo</a>

    <small class="nav-text text-default me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa fa fa-file-alt"></span>
     
    Reference
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/mlr3mbo.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mlr3book.mlr-org.com">
    <span class="fa fa fa fa-link"></span>
     
    mlr3book
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mlr-org/mlr3mbo/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">
    <span class="fa fa fa fa-comments"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://stackoverflow.com/questions/tagged/mlr3">
    <span class="fab fa fab fa-stack-overflow"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://mlr-org.com/">
    <span class="fa fa-rss"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>mlr3mbo</h1>
            <h3 data-toc-skip class="subtitle">Flexible Bayesian
Optimization in R</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlr-org/mlr3mbo/blob/HEAD/vignettes/mlr3mbo.Rmd" class="external-link"><code>vignettes/mlr3mbo.Rmd</code></a></small>
      <div class="d-none name"><code>mlr3mbo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> makes model
Bayesian optimization (BO) available within the <a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a> ecosystem. BO can be used for
optimizing any black box function, and is very suitable for
hyperparameter optimization of machine learning models. <a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> allows for building
custom BO algorithms relying on building blocks in a modular fashion,
but also provides a variety of standard single- and multi-objective BO
algorithms that can be used in a straightforward manner.</p>
<p>We assume that the reader is somewhat familiar with black box
optimization and <a href="https://bbotk.mlr-org.com" class="external-link">bbotk</a>,
hyperparameter optimization and <a href="https://mlr3tuning.mlr-org.com" class="external-link">mlr3tuning</a> and knows the
basics of BO. Background material is, for example, given by <span class="citation">Garnett (2022)</span>, <span class="citation">Bischl et
al. (2021)</span>, and <span class="citation">Becker et al.
(2022)</span>.</p>
</div>
<div class="section level2">
<h2 id="building-blocks">Building Blocks<a class="anchor" aria-label="anchor" href="#building-blocks"></a>
</h2>
<p>BO is an iterative optimization algorithm that makes use of a
so-called surrogate to model the unknown black box function. After
having observed an initial design of observations, the surrogate model
is trained on all data points observed so far and an acquisition
function is used to determine which points of the search space are
promising candidates that should be evaluated next. The acquisition
function relies only on the prediction of the surrogate model and
requires no evaluation of the true black box function and therefore is
comparably cheap to optimize. After having evaluated the next candidate,
the process repeats itself until a given termination criteria is
met.</p>
<p>Most BO flavors therefore follow a simple loop:</p>
<ol style="list-style-type: decimal">
<li>Fit the surrogate on all observations made so far.</li>
<li>Optimize the acquisition function to find the next candidate that
should be evaluated.</li>
<li>Evaluate the next candidate.</li>
</ol>
<p>In the following, the basic building blocks of BO and their
implementation in <a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> are
introduced in more detail.</p>
<div class="section level3">
<h3 id="loop-function">Loop Function<a class="anchor" aria-label="anchor" href="#loop-function"></a>
</h3>
<p>The <a href="https://mlr3mbo.mlr-org.com/reference/loop_function.html"><code>loop_function</code></a>
determines the behavior of the BO algorithm on a global level, i.e., how
the subroutine should look like that is performed at each iteration.</p>
<p>To get an overview of readily available <code>loop_function</code>s,
the following dictionary can be inspected:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: mlr3tuning</span></span>
<span><span class="co">#&gt; Loading required package: mlr3</span></span>
<span><span class="co">#&gt; Loading required package: paradox</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">mlr_loop_functions</span><span class="op">)</span></span>
<span><span class="co">#&gt;                key                         label    instance</span></span>
<span><span class="co">#&gt; 1:    bayesopt_ego Efficient Global Optimization single-crit</span></span>
<span><span class="co">#&gt; 2:   bayesopt_mpcl      Multipoint Constant Liar single-crit</span></span>
<span><span class="co">#&gt; 3: bayesopt_parego                        ParEGO  multi-crit</span></span>
<span><span class="co">#&gt; 4: bayesopt_smsego                        SmsEGO  multi-crit</span></span>
<span><span class="co">#&gt;                                   man</span></span>
<span><span class="co">#&gt; 1:    mlr3mbo::mlr_loop_functions_ego</span></span>
<span><span class="co">#&gt; 2:   mlr3mbo::mlr_loop_functions_mpcl</span></span>
<span><span class="co">#&gt; 3: mlr3mbo::mlr_loop_functions_parego</span></span>
<span><span class="co">#&gt; 4: mlr3mbo::mlr_loop_functions_smsego</span></span></code></pre></div>
<p>The dictionary shows the <code>key</code>, i.e., ID of the
<code>loop_function</code>, a brief description, for which optimization
instance the resulting BO flavor can be used, as well as how
documentation can be accessed.</p>
<p>Technically, all <code>loop_function</code>s are members of the
<code>S3</code> class <a href="https://mlr3mbo.mlr-org.com/reference/loop_function.html"><code>loop_function</code></a>,
and are simply decorated <a href="https://www.rdocumentation.org/packages/base/topics/function" class="external-link"><code>functions</code></a>
(because using an <a href="https://www.rdocumentation.org/packages/R6/topics/R6Class" class="external-link"><code>R6Class</code></a>
class would be over the top here - but this may change in the
future).</p>
<p>To write an own <code>loop_function</code>, users can get inspiration
from the readily available ones, e.g., <a href="https://mlr3mbo.mlr-org.com/reference/mlr_loop_functions_ego.html"><code>bayesopt_ego</code></a>
which performs sequential single-objective optimization:</p>
<p>After having made some assertions and safety checks, and having
evaluated the initial design, <code>bayesopt_ego</code> essentially only
performs the following steps:</p>
<ol style="list-style-type: decimal">
<li>
<code>acq_function$surrogate$update()</code> # update the surrogate
model</li>
<li>
<code>acq_function$update()</code> # update the acquisition function
(e.g., update the best value observed so far)</li>
<li>
<code>acq_optimizer$optimize()</code> # optimize the acquisition
function to yield a new candidate</li>
</ol>
</div>
<div class="section level3">
<h3 id="surrogate">Surrogate<a class="anchor" aria-label="anchor" href="#surrogate"></a>
</h3>
<p>A surrogate encapsulates a regression learner that models the unknown
black box function based on observed data. In <a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a>, <a href="https://mlr3mbo.mlr-org.com/reference/SurrogateLearner.html"><code>SurrogateLearner</code></a>
and <a href="https://mlr3mbo.mlr-org.com/reference/SurrogateLearnerCollection.html"><code>SurrogateLearnerCollection</code></a>
are the higher-level <code>R6</code> classes which should be used to
construct a surrogate, inheriting from the base <a href="https://mlr3mbo.mlr-org.com/reference/Surrogate.html"><code>Surrogate</code></a>
class.</p>
<p>As a learner, any <a href="https://mlr3.mlr-org.com/reference/LearnerRegr.html" class="external-link"><code>LearnerRegr</code></a>
from <a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a> can be used, however,
most acquisition functions require both a mean and a variance prediction
(therefore not all learners are suitable for all scenarios). Typical
choices include:</p>
<ul>
<li>A <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.km.html" class="external-link"><code>Gaussian process</code></a>
for low dimensional numeric search spaces</li>
<li>A <a href="https://mlr3learners.mlr-org.com/reference/mlr_learners_regr.ranger.html" class="external-link"><code>Random forest</code></a>
for higher dimensional mixed (and / or hierarchical) search spaces</li>
</ul>
<p>A <code>SurrogateLearner</code> can be constructed via:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="va">surrogate</span> <span class="op">=</span> <span class="va"><a href="../reference/SurrogateLearner.html">SurrogateLearner</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.km"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>or using syntactic sugar:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surrogate</span> <span class="op">=</span> <span class="fu"><a href="../reference/srlrn.html">srlrn</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.km"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The encapsulated learner can be accessed via the <code>$model</code>
field:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surrogate</span><span class="op">$</span><span class="va">model</span></span>
<span><span class="co">#&gt; &lt;LearnerRegrKM:regr.km&gt;</span></span>
<span><span class="co">#&gt; * Model: -</span></span>
<span><span class="co">#&gt; * Parameters: list()</span></span>
<span><span class="co">#&gt; * Packages: mlr3, mlr3learners, DiceKriging</span></span>
<span><span class="co">#&gt; * Predict Types:  response, [se]</span></span>
<span><span class="co">#&gt; * Feature Types: logical, integer, numeric</span></span>
<span><span class="co">#&gt; * Properties: -</span></span></code></pre></div>
<p>The surrogate itself has the following hyperparameters:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surrogate</span><span class="op">$</span><span class="va">param_set</span></span>
<span><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span><span class="co">#&gt;                      id    class lower upper nlevels        default</span></span>
<span><span class="co">#&gt; 1: assert_insample_perf ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;</span></span>
<span><span class="co">#&gt; 2:         catch_errors ParamLgl    NA    NA       2 &lt;NoDefault[3]&gt;</span></span>
<span><span class="co">#&gt; 3:         perf_measure ParamUty    NA    NA     Inf &lt;NoDefault[3]&gt;</span></span>
<span><span class="co">#&gt; 4:       perf_threshold ParamDbl  -Inf   Inf     Inf &lt;NoDefault[3]&gt;</span></span>
<span><span class="co">#&gt;                 parents value</span></span>
<span><span class="co">#&gt; 1:                      FALSE</span></span>
<span><span class="co">#&gt; 2:                       TRUE</span></span>
<span><span class="co">#&gt; 3: assert_insample_perf      </span></span>
<span><span class="co">#&gt; 4: assert_insample_perf</span></span></code></pre></div>
<p><code>assert_insample_perf = TRUE</code> results in the insample
performance of the learner being calculated after each
<code>$update()</code>. This requires the specification of a
<code>perf_measure</code> (any regression measure, e.g., <a href="https://mlr3.mlr-org.com/reference/mlr_measures_regr.rsq.html" class="external-link"><code>R squared</code></a>)
and a <code>perf_threshold</code>. After fitting the surrogate, the
insample performance of the surrogate is calculated and asserted against
the performance threshold. If the threshold is not met, an error is
thrown (that is caught within the optimization loop - unless
<code>catch_errors = FALSE</code> and results in, e.g., proposing the
next candidate uniformly at random). For more details on this mechanism,
see the <a href="#safety-nets">Safety Nets</a> section.</p>
<p>Note that this assertion is not always meaningful, e.g., in the case
of using a Gaussian process with no nugget, the insample performance
will always be perfect.</p>
<p>Internally, the learner is fitted on a regression task constructed
from the <a href="https://bbotk.mlr-org.com/reference/Archive.html" class="external-link"><code>Archive</code></a>
of the <a href="https://bbotk.mlr-org.com/reference/OptimInstance.html" class="external-link"><code>OptimInstance</code></a>
that is to be optimized and features and the target variable are
determined automatically but can also be specified via the
<code>x_cols</code> and <code>y_cols</code> active bindings. Ideally,
the <code>Archive</code> is already passed during construction, however,
lazy initialization is also possible.</p>
<p>Important methods are <code>$update()</code> and
<code>$predict()</code> with the former one typically being used within
the <code>loop_function</code> and the latter one being used within the
evaluation of an acquisition function.</p>
<p>Depending on the choice of the <code>loop_function</code>, multiple
targets must be modelled by (currently independent) surrogates, in which
case a <code>SurrogateLearnerCollection</code> should be used.
Construction and hyperparameters are analogous to the single target
scenario described above.</p>
<p>To get an overview of all available regression learners within the <a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a> ecosystem, use:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="co"># there are plenty of more in mlr3extralearners</span></span>
<span><span class="co"># library(mlr3extralearners)</span></span>
<span><span class="va">learners</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">mlr_learners</span><span class="op">)</span></span>
<span><span class="va">learners</span><span class="op">[</span><span class="va">task_type</span> <span class="op">==</span> <span class="st">"regr"</span><span class="op">]</span></span></code></pre></div>
<p>To use a custom learner not included in <a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a>, <a href="https://mlr3learners.mlr-org.com" class="external-link">mlr3learners</a>, or <a href="https://mlr3extralearners.mlr-org.com" class="external-link">mlr3extralearners</a>, you
can write a custom <a href="https://mlr3.mlr-org.com/reference/LearnerRegr.html" class="external-link"><code>LearnerRegr</code></a>
and use this learner within the surrogate.</p>
</div>
<div class="section level3">
<h3 id="acquisition-function">Acquisition Function<a class="anchor" aria-label="anchor" href="#acquisition-function"></a>
</h3>
<p>Based on a surrogate, an acquisition function quantifies the
attractiveness of each point of the search space if it were to be
evaluated in the next iteration.</p>
<p>A popular example is given by the Expected Improvement <span class="citation">(Jones, Schonlau, and Welch 1998)</span>:</p>
<p><span class="math display">\[
\mathbb{E}_{y} \left[ \max \left( f_{\mathrm{min}} - y, 0 \right)
\right]
\]</span> Here, <span class="math inline">\(y\)</span> is the surrogate
prediction for a given point <span class="math inline">\(x\)</span>
(which when using a Gaussian process follows a normal distribution) and
<span class="math inline">\(f_{\mathrm{min}}\)</span> is the currently
best function value observed so far.</p>
<p>To get an overview of available acquisition functions, the following
dictionary can be inspected:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">mlr_acqfunctions</span><span class="op">)</span></span>
<span><span class="co">#&gt;        key                           label                               man</span></span>
<span><span class="co">#&gt; 1:     aei  Augmented Expected Improvement     mlr3mbo::mlr_acqfunctions_aei</span></span>
<span><span class="co">#&gt; 2:      cb  Lower / Upper Confidence Bound      mlr3mbo::mlr_acqfunctions_cb</span></span>
<span><span class="co">#&gt; 3:      ei            Expected Improvement      mlr3mbo::mlr_acqfunctions_ei</span></span>
<span><span class="co">#&gt; 4:    eips Expected Improvement Per Second    mlr3mbo::mlr_acqfunctions_eips</span></span>
<span><span class="co">#&gt; 5:      pi      Probability Of Improvement      mlr3mbo::mlr_acqfunctions_pi</span></span>
<span><span class="co">#&gt; 6: sms_ego                         SMS EGO mlr3mbo::mlr_acqfunctions_sms_ego</span></span></code></pre></div>
<p>The dictionary shows the <code>key</code>, i.e., ID of the
acquisition function, a brief description, and how the documentation can
be accessed.</p>
<p>Technically, all acquisition functions inherit from the
<code>R6</code> class <a href="https://mlr3mbo.mlr-org.com/reference/AcqFunction.html"><code>AcqFunction</code></a>
which itself simply inherits from the base <a href="https://bbotk.mlr-org.com/reference/Objective.html" class="external-link"><code>Objective</code></a>
class.</p>
<p>Construction is straightforward via:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acq_function</span> <span class="op">=</span> <span class="va"><a href="../reference/mlr_acqfunctions_ei.html">AcqFunctionEI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>or using syntactic sugar:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acq_function</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqf.html">acqf</a></span><span class="op">(</span><span class="st">"ei"</span><span class="op">)</span></span></code></pre></div>
<p>Internally, the <code>domain</code> and <code>codomain</code> are
constructed based on the <a href="https://bbotk.mlr-org.com/reference/Archive.html" class="external-link"><code>Archive</code></a>
referenced by the <a href="https://mlr3mbo.mlr-org.com/reference/Surrogate.html"><code>Surrogate</code></a>
and therefore the <code>surrogate</code> should be passed as an argument
already during construction.</p>
<p>However, lazy initialization is also possible.</p>
<p>In the case of the acquisition function itself being parameterized,
hyperparameters should be passed as constants, e.g.:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/acqf.html">acqf</a></span><span class="op">(</span><span class="st">"cb"</span><span class="op">)</span> <span class="co"># lower / upper confidence bound with lambda hyperparameter</span></span>
<span><span class="co">#&gt; &lt;AcqFunctionCB:acq_cb&gt;</span></span>
<span><span class="co">#&gt; Domain:</span></span>
<span><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span><span class="co">#&gt; Empty.</span></span>
<span><span class="co">#&gt; Codomain:</span></span>
<span><span class="co">#&gt; &lt;Codomain&gt;</span></span>
<span><span class="co">#&gt; Empty.</span></span>
<span><span class="co">#&gt; Constants:</span></span>
<span><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span><span class="co">#&gt;        id    class lower upper nlevels default value</span></span>
<span><span class="co">#&gt; 1: lambda ParamDbl     0   Inf     Inf       2     2</span></span></code></pre></div>
<p>To use a custom acquisition function you should implement a new
<code>R6</code> class inheriting from <a href="https://mlr3mbo.mlr-org.com/reference/AcqFunction.html"><code>AcqFunction</code></a>.</p>
</div>
<div class="section level3">
<h3 id="acquisition-function-optimizer">Acquisition Function Optimizer<a class="anchor" aria-label="anchor" href="#acquisition-function-optimizer"></a>
</h3>
<p>To find the most promising candidate for evaluation, the acquisition
function itself must be optimized. Internally, an <a href="https://bbotk.mlr-org.com/reference/OptimInstance.html" class="external-link"><code>OptimInstance</code></a>
is constructed using the acquisition function as an <a href="https://bbotk.mlr-org.com/reference/Objective.html" class="external-link"><code>Objective</code></a>.</p>
<p>An acquisition function optimizer is then used to solve this
optimization problem. Technically, this optimizer is a member of the <a href="https://mlr3mbo.mlr-org.com/reference/AcqOptimizer.html"><code>AcqOptimizer</code></a>
<code>R6</code> class.</p>
<p>Construction requires specifying an <a href="https://bbotk.mlr-org.com/reference/Optimizer.html" class="external-link"><code>Optimizer</code></a>
as well as a <a href="https://bbotk.mlr-org.com/reference/Terminator.html" class="external-link"><code>Terminator</code></a>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bbotk.mlr-org.com" class="external-link">bbotk</a></span><span class="op">)</span></span>
<span><span class="va">acq_optimizer</span> <span class="op">=</span> <span class="va"><a href="../reference/AcqOptimizer.html">AcqOptimizer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"random_search"</span><span class="op">)</span>, terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Syntactic sugar:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acq_optimizer</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqo.html">acqo</a></span><span class="op">(</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"random_search"</span><span class="op">)</span>, terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The optimizer and terminator can be accessed via the
<code>$optimizer</code> and <code>$terminator</code> fields:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acq_optimizer</span><span class="op">$</span><span class="va">optimizer</span></span>
<span><span class="co">#&gt; &lt;OptimizerRandomSearch&gt;: Random Search</span></span>
<span><span class="co">#&gt; * Parameters: batch_size=1</span></span>
<span><span class="co">#&gt; * Parameter classes: ParamLgl, ParamInt, ParamDbl, ParamFct</span></span>
<span><span class="co">#&gt; * Properties: dependencies, single-crit, multi-crit</span></span>
<span><span class="co">#&gt; * Packages: bbotk</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acq_optimizer</span><span class="op">$</span><span class="va">terminator</span></span>
<span><span class="co">#&gt; &lt;TerminatorEvals&gt;: Number of Evaluation</span></span>
<span><span class="co">#&gt; * Parameters: n_evals=100, k=0</span></span></code></pre></div>
<p>Internally, the acquisition function optimizer also requires the
acquisition function and therefore the <code>acq_function</code>
argument should be specified during construction.</p>
<p>However, lazy initialization is also possible.</p>
<p>Any <a href="https://mlr3mbo.mlr-org.com/reference/AcqOptimizer.html"><code>AcqOptimizer</code></a>
has the following hyperparameters:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">acq_optimizer</span><span class="op">$</span><span class="va">param_set</span></span>
<span><span class="co">#&gt; &lt;ParamSet&gt;</span></span>
<span><span class="co">#&gt;                        id    class lower upper nlevels        default   parents</span></span>
<span><span class="co">#&gt; 1:           catch_errors ParamLgl    NA    NA       2           TRUE          </span></span>
<span><span class="co">#&gt; 2:          logging_level ParamFct    NA    NA       6           warn          </span></span>
<span><span class="co">#&gt; 3: skip_already_evaluated ParamLgl    NA    NA       2           TRUE          </span></span>
<span><span class="co">#&gt; 4:              warmstart ParamLgl    NA    NA       2          FALSE          </span></span>
<span><span class="co">#&gt; 5:         warmstart_size ParamInt     1   Inf     Inf &lt;NoDefault[3]&gt; warmstart</span></span>
<span><span class="co">#&gt;    value</span></span>
<span><span class="co">#&gt; 1:  TRUE</span></span>
<span><span class="co">#&gt; 2:  warn</span></span>
<span><span class="co">#&gt; 3:  TRUE</span></span>
<span><span class="co">#&gt; 4: FALSE</span></span>
<span><span class="co">#&gt; 5:</span></span></code></pre></div>
<p><code>catch_errors = TRUE</code> results in catching any errors that
can happen during the acquisition function optimization which allows
for, e.g., proposing the next candidate uniformly at random within the
<code>loop_function</code>. For more details on this mechanism, see the
<a href="#safety-nets">Safety Nets</a> section.
<code>logging_level</code> specifies the logging level during
acquisition function optimization. Often it is useful to only log the
progress of the BO loop and therefore <code>logging_level</code> is set
to <code>"warn"</code> by default. For debugging purposes, this should
be set to <code>"info"</code>.
<code>skip_already_evaluated = TRUE</code> will result in not proposing
candidates for evaluation that were already evaluated in previous
iterations. <code>warmstart = TRUE</code> results in the best
<code>warmstart_size</code> points present in the <code>Archive</code>
of the <code>OptimInstance</code> to also be evaluated on the
acquisition function <code>OptimInstance</code> prior to running the
actual optimization. This is especially useful in the case of using
evolutionary algorithms or variants of local search as the acquisition
function optimizer (as the current best points should usually be part of
the initial population to further optimize local optima).</p>
<p>To get an overview of all <code>Optimizer</code>s implemented in <a href="https://bbotk.mlr-org.com" class="external-link">bbotk</a> you can use:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">mlr_optimizers</span><span class="op">)</span></span></code></pre></div>
<p>And similarly for <code>Terminator</code>s:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">mlr_terminators</span><span class="op">)</span></span></code></pre></div>
<p>Again, you can also use custom <code>Optimizer</code>s or
<code>Terminator</code>s by implementing new <code>R6</code> classes
inheriting from <a href="https://bbotk.mlr-org.com/reference/Optimizer.html" class="external-link"><code>Optimizer</code></a>
and respectively <a href="https://bbotk.mlr-org.com/reference/Terminator.html" class="external-link"><code>Terminator</code></a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="putting-it-together">Putting it Together<a class="anchor" aria-label="anchor" href="#putting-it-together"></a>
</h2>
<p>Having introduced all building blocks we are now ready to put
everything together in the form of an <a href="https://mlr3mbo.mlr-org.com/reference/mlr_optimizers_mbo.html"><code>OptimizerMbo</code></a>
and <a href="https://mlr3mbo.mlr-org.com/reference/mlr_tuners_mbo.html"><code>TunerMbo</code></a>.</p>
<p><code>OptimizerMbo</code> inherits from <a href="https://bbotk.mlr-org.com/reference/Optimizer.html" class="external-link"><code>Optimizer</code></a>
and requires a <code>loop_function</code>, <code>surrogate</code>,
<code>acq_function</code> and <code>acq_optimizer</code>.</p>
<p>Besides, additional arguments, i.e., arguments of the
<code>loop_function</code> can be passed via the <code>args</code>
active binding. Finally, the mechanism how the final result is obtained
after the optimization progress (i.e., the best point in the case of
single-objective and the Pareto set in the case of multi-objective
optimization) can be changed via the <code>result_function</code> active
binding. As an example, <a href="https://mlr3mbo.mlr-org.com/reference/result_by_surrogate_design.html"><code>result_by_surrogate_design</code></a>
will choose the final solution based on the prediction of the surrogate
instead of the evaluations logged in the <code>Archive</code> which is
sensible in the case of noisy objective functions.</p>
<p>Construction is performed via:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimizer</span> <span class="op">=</span> <span class="va"><a href="../reference/mlr_optimizers_mbo.html">OptimizerMbo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">bayesopt_ego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span><span class="op">)</span></span></code></pre></div>
<p>or using syntactic sugar:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimizer</span> <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"mbo"</span>,</span>
<span>  loop_function <span class="op">=</span> <span class="va">bayesopt_ego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optimizer</span></span>
<span><span class="co">#&gt; &lt;OptimizerMbo&gt;: Model Based Optimization</span></span>
<span><span class="co">#&gt; * Parameter classes: ParamLgl, ParamInt, ParamDbl</span></span>
<span><span class="co">#&gt; * Properties: single-crit</span></span>
<span><span class="co">#&gt; * Packages: mlr3mbo, mlr3, mlr3learners, DiceKriging, bbotk</span></span>
<span><span class="co">#&gt; * Loop function: bayesopt_ego</span></span>
<span><span class="co">#&gt; * Surrogate: LearnerRegrKM</span></span>
<span><span class="co">#&gt; * Acquisition Function: AcqFunctionEI</span></span>
<span><span class="co">#&gt; * Acquisition Function Optimizer: (OptimizerRandomSearch |</span></span>
<span><span class="co">#&gt;   TerminatorEvals)</span></span></code></pre></div>
<p>Note that important fields such as <code>$param_classes</code>,
<code>$packages</code>, <code>$properties</code> are automatically
determined based on the choice of the <code>loop_function</code>,
<code>surrogate</code>, <code>acq_function</code>, and
<code>acq_optimizer</code>.</p>
<p>If arguments such as the <code>surrogate</code>,
<code>acq_function</code>, and <code>acq_optimizer</code> where not
fully specified during construction, e.g., the <code>surrogate</code>
missing the <code>archive</code>, or the <code>acq_function</code>
missing the <code>surrogate</code>, lazy initialization is completed
prior to the optimizer being used for optimization.</p>
<p>An object of class <code>OptimizerMbo</code> can be used to optimize
an object of class <a href="https://bbotk.mlr-org.com/reference/OptimInstanceSingleCrit.html" class="external-link"><code>OptimInstanceSingleCrit</code></a>
or <a href="https://bbotk.mlr-org.com/reference/OptimInstanceMultiCrit.html" class="external-link"><code>OptimInstanceMultiCrit</code></a>.</p>
<p>For hyperparameter optimization, <a href="https://mlr3mbo.mlr-org.com/reference/mlr_tuners_mbo.html"><code>TunerMbo</code></a>
should be used (which simply relies on an <code>OptimizerMbo</code> that
is constructed internally):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tuner</span> <span class="op">=</span> <span class="va"><a href="../reference/mlr_tuners_mbo.html">TunerMbo</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">bayesopt_ego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span><span class="op">)</span></span>
<span><span class="fu">mlr3misc</span><span class="fu">::</span><span class="fu"><a href="https://mlr3misc.mlr-org.com/reference/get_private.html" class="external-link">get_private</a></span><span class="op">(</span><span class="va">tuner</span><span class="op">)</span><span class="op">[[</span><span class="st">".optimizer"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;OptimizerMbo&gt;: Model Based Optimization</span></span>
<span><span class="co">#&gt; * Parameter classes: ParamLgl, ParamInt, ParamDbl</span></span>
<span><span class="co">#&gt; * Properties: single-crit</span></span>
<span><span class="co">#&gt; * Packages: mlr3mbo, mlr3, mlr3learners, DiceKriging, bbotk</span></span>
<span><span class="co">#&gt; * Loop function: bayesopt_ego</span></span>
<span><span class="co">#&gt; * Surrogate: LearnerRegrKM</span></span>
<span><span class="co">#&gt; * Acquisition Function: AcqFunctionEI</span></span>
<span><span class="co">#&gt; * Acquisition Function Optimizer: (OptimizerRandomSearch |</span></span>
<span><span class="co">#&gt;   TerminatorEvals)</span></span></code></pre></div>
<div class="section level3">
<h3 id="the-initial-design">The Initial Design<a class="anchor" aria-label="anchor" href="#the-initial-design"></a>
</h3>
<p><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> offers two
different ways for specifying an initial design:</p>
<ol style="list-style-type: decimal">
<li>One can simply evaluate points on the <code>OptimInstance</code>
that is to be optimized prior to using an <code>OptimizerMbo</code>. In
this case, the <code>loop_function</code> should skip the construction
and evaluation of an initial design.</li>
<li>If no points were already evaluated on the
<code>OptimInstance</code>, the <code>loop_function</code> should
construct an initial design itself and evaluate it, e.g.,
<code>bayesopt_ego</code> constructs an initial design of size <span class="math inline">\(4D\)</span> where <span class="math inline">\(D\)</span> is the dimensionality of the search
space by sampling points uniformly at random.</li>
</ol>
<p>Functions for creating different initial designs are part of the <a href="https://paradox.mlr-org.com" class="external-link">paradox</a> package, e.g.:</p>
<ol style="list-style-type: decimal">
<li>
<a href="https://paradox.mlr-org.com/reference/generate_design_random.html" class="external-link"><code>generate_design_random</code></a>:
uniformly at random</li>
<li>
<a href="https://paradox.mlr-org.com/reference/generate_design_grid.html" class="external-link"><code>generate_design_grid</code></a>:
uniform sized grid</li>
<li>
<a href="https://paradox.mlr-org.com/reference/generate_design_lhs.html" class="external-link"><code>generate_design_lhs</code></a>:
Latin hypercube sampling</li>
<li>
<a href="https://paradox.mlr-org.com/reference/generate_design_sobol.html" class="external-link"><code>generate_design_sobol</code></a>:
Sobol sequence</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="defaults">Defaults<a class="anchor" aria-label="anchor" href="#defaults"></a>
</h2>
<p><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> tries to use
intelligent defaults for the <code>loop_function</code>,
<code>surrogate</code>, <code>acq_function</code>, and
<code>acq_optimizer</code> within <code>OptimizerMbo</code> and
<code>TunerMbo</code>.</p>
<p>For details, see <a href="https://mlr3mbo.mlr-org.com/reference/mbo_defaults.html"><code>mbo_defaults</code></a>.</p>
</div>
<div class="section level2">
<h2 id="safety-nets">Safety Nets<a class="anchor" aria-label="anchor" href="#safety-nets"></a>
</h2>
<p><a href="https://mlr3mbo.mlr-org.com">mlr3mbo</a> is quite stable in
the sense that - if desired - all kinds of errors can be caught and
handled appropriately within the <a href="https://mlr3mbo.mlr-org.com/reference/loop_function.html"><code>loop_function</code></a>.</p>
<p>As an example, let’s have a look at the inner workings of <a href="https://mlr3mbo.mlr-org.com/reference/mlr_loop_functions_ego.html"><code>bayesopt_ego</code></a>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">repeat</span> <span class="op">{</span></span>
<span>  <span class="va">xdt</span> <span class="op">=</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">.</span></span>
<span>    <span class="va">.</span></span>
<span>    <span class="va">.</span></span>
<span>    <span class="va">acq_function</span><span class="op">$</span><span class="va">surrogate</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">acq_function</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">acq_optimizer</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, mbo_error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">mbo_error_condition</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">lg</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">mbo_error_condition</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" / "</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">lg</span><span class="op">$</span><span class="fu">info</span><span class="op">(</span><span class="st">"Proposing a randomly sampled point"</span><span class="op">)</span></span>
<span>    <span class="va"><a href="https://paradox.mlr-org.com/reference/SamplerUnif.html" class="external-link">SamplerUnif</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">domain</span><span class="op">)</span><span class="op">$</span><span class="fu">sample</span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">.</span></span>
<span>  <span class="va">.</span></span>
<span>  <span class="va">.</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In each iteration, a new candidate is chosen based on updating the
surrogate, and optimizing the acquisition function. If any error happens
during any of these steps, errors are upgraded to errors of class
<code>"mbo_error"</code> (and <code>"surrogate_update_error"</code> for
surrogate related errors as well as <code>"acq_optimizer_error"</code>
for acquisition function optimization related errors). These errors are
then caught and a fallback is triggered: Evaluating the next candidate
chosen uniformly at random. Note that the same mechanism is actually
also used to handle random interleaving.</p>
<p>To illustrate this, consider the following scenario: We try to
minimize <span class="math inline">\(f(x) = x^2\)</span> for <span class="math inline">\(x \in [-1, 1]\)</span>, however, our Gaussian
process fails due to data points being too close to each other:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2906</span><span class="op">)</span></span>
<span><span class="va">domain</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">codomain</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"minimize"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objective_function</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">objective</span> <span class="op">=</span> <span class="va"><a href="https://bbotk.mlr-org.com/reference/ObjectiveRFun.html" class="external-link">ObjectiveRFun</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  fun <span class="op">=</span> <span class="va">objective_function</span>,</span>
<span>  domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  codomain <span class="op">=</span> <span class="va">codomain</span><span class="op">)</span></span>
<span></span>
<span><span class="va">instance</span> <span class="op">=</span> <span class="va"><a href="https://bbotk.mlr-org.com/reference/OptimInstanceSingleCrit.html" class="external-link">OptimInstanceSingleCrit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  objective <span class="op">=</span> <span class="va">objective</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">initial_design</span> <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">instance</span><span class="op">$</span><span class="fu">eval_batch</span><span class="op">(</span><span class="va">initial_design</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surrogate</span> <span class="op">=</span> <span class="fu"><a href="../reference/srlrn.html">srlrn</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.km"</span>,</span>
<span>  covtype <span class="op">=</span> <span class="st">"matern3_2"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"gen"</span>,</span>
<span>  nugget.stability <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">8</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">acq_function</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqf.html">acqf</a></span><span class="op">(</span><span class="st">"ei"</span><span class="op">)</span></span>
<span><span class="va">acq_optimizer</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqo.html">acqo</a></span><span class="op">(</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"random_search"</span>, batch_size <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">optimizer</span> <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"mbo"</span>,</span>
<span>  loop_function <span class="op">=</span> <span class="va">bayesopt_ego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span><span class="op">)</span></span>
<span></span>
<span><span class="va">optimizer</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #FFD75F;">WARN </span> [11:07:42.043] [bbotk] missing value where TRUE/FALSE needed</span></span>
<span><span class="co">#&gt;             x  x_domain            y</span></span>
<span><span class="co">#&gt; 1: 0.01617037 &lt;list[1]&gt; 0.0002614808</span></span></code></pre></div>
<p>The log tells us that an error happened and was caught:
<code>"surrogate_update_error / mbo_error / error / condition"</code>.
We also see in the <code>Archive</code> that the first candidate after
the initial design (the fifth point) was not proposed based on
optimizing the acquisition function:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="co">#&gt;               x            y  x_domain           timestamp batch_nr     acq_ei</span></span>
<span><span class="co">#&gt;  1:  1.00000000 1.0000000000 &lt;list[1]&gt; 2022-11-04 11:07:41        1         NA</span></span>
<span><span class="co">#&gt;  2:  1.00000000 1.0000000000 &lt;list[1]&gt; 2022-11-04 11:07:41        1         NA</span></span>
<span><span class="co">#&gt;  3:  1.00000000 1.0000000000 &lt;list[1]&gt; 2022-11-04 11:07:41        1         NA</span></span>
<span><span class="co">#&gt;  4:  1.00000000 1.0000000000 &lt;list[1]&gt; 2022-11-04 11:07:41        1         NA</span></span>
<span><span class="co">#&gt;  5:  0.67422986 0.4545859064 &lt;list[1]&gt; 2022-11-04 11:07:42        2         NA</span></span>
<span><span class="co">#&gt;  6:  0.66865060 0.4470936288 &lt;list[1]&gt; 2022-11-04 11:07:42        3 0.04353973</span></span>
<span><span class="co">#&gt;  7:  0.45532567 0.2073214654 &lt;list[1]&gt; 2022-11-04 11:07:42        4 0.08484722</span></span>
<span><span class="co">#&gt;  8: -0.24229299 0.0587058937 &lt;list[1]&gt; 2022-11-04 11:07:43        5 0.18996974</span></span>
<span><span class="co">#&gt;  9: -0.99835097 0.9967046528 &lt;list[1]&gt; 2022-11-04 11:07:43        6 0.09128581</span></span>
<span><span class="co">#&gt; 10:  0.01617037 0.0002614808 &lt;list[1]&gt; 2022-11-04 11:07:43        7 0.09341134</span></span>
<span><span class="co">#&gt;     .already_evaluated</span></span>
<span><span class="co">#&gt;  1:                 NA</span></span>
<span><span class="co">#&gt;  2:                 NA</span></span>
<span><span class="co">#&gt;  3:                 NA</span></span>
<span><span class="co">#&gt;  4:                 NA</span></span>
<span><span class="co">#&gt;  5:                 NA</span></span>
<span><span class="co">#&gt;  6:              FALSE</span></span>
<span><span class="co">#&gt;  7:              FALSE</span></span>
<span><span class="co">#&gt;  8:              FALSE</span></span>
<span><span class="co">#&gt;  9:              FALSE</span></span>
<span><span class="co">#&gt; 10:              FALSE</span></span></code></pre></div>
<p>Nevertheless, due to the safety net, the BO loop eventually worked
just fine and did not simply throw an error.</p>
<p>If we set <code>catch_errors = FALSE</code> within the surrogate, we
see that the error was indeed caused by the surrogate:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="fu">clear</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">instance</span><span class="op">$</span><span class="fu">eval_batch</span><span class="op">(</span><span class="va">initial_design</span><span class="op">)</span></span>
<span><span class="va">optimizer</span><span class="op">$</span><span class="va">surrogate</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">catch_errors</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="va">optimizer</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in if (varinit.vario &lt;= 1e-20) varinit.vario &lt;- 1/2 * varinit.vario.total: missing value where TRUE/FALSE needed</span></span></code></pre></div>
<p>In case of the error belonging to the
<code>acq_optimizer_error</code> class, it is helpful to increase the
logging level of the acquisition function optimizer (e.g.,
<code>acq_optimizer$param_set$values$logging_level = "info"</code>) and
also set
<code>acq_optimizer$param_set$values$catch_errors = FALSE</code>. This
allows for straightforward debugging.</p>
<p>To make sure that your BO loop behaved as expected, always inspect
the log of the optimization process and inspect the <code>Archive</code>
and check whether the acquisition function column is populated as
expected.</p>
</div>
<div class="section level2">
<h2 id="writing-your-own-loop-function">Writing Your Own Loop Function<a class="anchor" aria-label="anchor" href="#writing-your-own-loop-function"></a>
</h2>
<p>Writing a custom <code>loop_function</code> is straightforward.</p>
<p>Any <code>loop_function</code> must be a decorated member of the S3
class <a href="https://mlr3mbo.mlr-org.com/reference/loop_function.html"><code>loop_function</code></a>.
Arguments must include <code>instance</code>, <code>surrogate</code>,
<code>acq_function</code>, and <code>acq_optimizer</code> and attributes
must include <code>id</code> (id of the loop function),
<code>label</code> (brief description), <code>instance</code>
(“single-crit” and or “multi_crit”), and <code>man</code> (link to the
manual page).</p>
<p>Technically, any <code>loop_function</code> therefore looks like the
following:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayesopt_custom</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">instance</span>, <span class="va">surrogate</span>, <span class="va">acq_function</span>, <span class="va">acq_optimizer</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># typically some assertions</span></span>
<span></span>
<span>  <span class="co"># initial design handling</span></span>
<span></span>
<span>  <span class="co"># actual loop function</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">bayesopt_custom</span><span class="op">)</span> <span class="op">=</span> <span class="st">"loop_function"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bayesopt_custom</span>, <span class="st">"id"</span><span class="op">)</span> <span class="op">=</span> <span class="st">"bayesopt_custom"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bayesopt_custom</span>, <span class="st">"label"</span><span class="op">)</span> <span class="op">=</span> <span class="st">"Test"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bayesopt_custom</span>, <span class="st">"instance"</span><span class="op">)</span> <span class="op">=</span> <span class="st">"single-crit"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">bayesopt_custom</span>, <span class="st">"man"</span><span class="op">)</span> <span class="op">=</span> <span class="st">""</span>  <span class="co"># no man page</span></span>
<span><span class="co"># if you want to add it to the dictionary: mlr_loop_functions$add("bayesopt_ego", bayesopt_ego)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bayesopt_custom</span></span>
<span><span class="co">#&gt; Loop function: bayesopt_custom</span></span>
<span><span class="co">#&gt; * Description: Test</span></span>
<span><span class="co">#&gt; * Supported Instance: single-crit</span></span></code></pre></div>
<p>For some inspiration on how to write actual meaningful
<code>loop_function</code>s, see, e.g., <a href="https://mlr3mbo.mlr-org.com/reference/mlr_loop_functions_ego.html"><code>bayesopt_ego</code></a>.</p>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>In this final section, some standard examples are provided.</p>
<div class="section level3">
<h3 id="single-objective-2d-schwefel-function">Single-Objective: 2D Schwefel Function<a class="anchor" aria-label="anchor" href="#single-objective-2d-schwefel-function"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">objective_function</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">418.9829</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">xs</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">domain</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="op">-</span><span class="fl">500</span>, upper <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>  x2 <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="op">-</span><span class="fl">500</span>, upper <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">codomain</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"minimize"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objective</span> <span class="op">=</span> <span class="va"><a href="https://bbotk.mlr-org.com/reference/ObjectiveRFun.html" class="external-link">ObjectiveRFun</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  fun <span class="op">=</span> <span class="va">objective_function</span>,</span>
<span>  domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  codomain <span class="op">=</span> <span class="va">codomain</span><span class="op">)</span></span>
<span></span>
<span><span class="va">instance</span> <span class="op">=</span> <span class="va"><a href="https://bbotk.mlr-org.com/reference/OptimInstanceSingleCrit.html" class="external-link">OptimInstanceSingleCrit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  objective <span class="op">=</span> <span class="va">objective</span>,</span>
<span>  search_space <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gaussian process, EI, DIRECT</span></span>
<span><span class="va">surrogate</span> <span class="op">=</span> <span class="fu"><a href="../reference/srlrn.html">srlrn</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.km"</span>,</span>
<span>  covtype <span class="op">=</span> <span class="st">"matern3_2"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"gen"</span>,</span>
<span>  nugget.stability <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">8</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">acq_function</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqf.html">acqf</a></span><span class="op">(</span><span class="st">"ei"</span><span class="op">)</span></span>
<span><span class="va">acq_optimizer</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqo.html">acqo</a></span><span class="op">(</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"nloptr"</span>, algorithm <span class="op">=</span> <span class="st">"NLOPT_GN_DIRECT_L"</span><span class="op">)</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"stagnation"</span>, threshold <span class="op">=</span> <span class="fl">1e-8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">optimizer</span> <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"mbo"</span>,</span>
<span>  loop_function <span class="op">=</span> <span class="va">bayesopt_ego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2906</span><span class="op">)</span></span>
<span><span class="va">optimizer</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">batch_nr</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cummin</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_step</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Batch Nr."</span>, y <span class="op">=</span> <span class="st">"Best y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xdt</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/generate_design_grid.html" class="external-link">generate_design_grid</a></span><span class="op">(</span><span class="va">instance</span><span class="op">$</span><span class="va">search_space</span>, resolution <span class="op">=</span> <span class="fl">101</span><span class="op">)</span><span class="op">$</span><span class="va">data</span></span>
<span><span class="va">ydt</span> <span class="op">=</span> <span class="va">objective</span><span class="op">$</span><span class="fu">eval_dt</span><span class="op">(</span><span class="va">xdt</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x1</span>, y <span class="op">=</span> <span class="va">x2</span>, z <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">xdt</span>, <span class="va">ydt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_contour_filled</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>color <span class="op">=</span> <span class="va">batch_nr</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span>, data <span class="op">=</span> <span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_gradient</span><span class="op">(</span>low <span class="op">=</span> <span class="st">"lightgrey"</span>, high <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multi-objective-schaffer-function-n--1">Multi-Objective: Schaffer Function N. 1<a class="anchor" aria-label="anchor" href="#multi-objective-schaffer-function-n--1"></a>
</h3>
<div class="section level4">
<h4 id="parego">ParEGO<a class="anchor" aria-label="anchor" href="#parego"></a>
</h4>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">objective_function</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y1 <span class="op">=</span> <span class="va">xs</span><span class="op">$</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span>, y2 <span class="op">=</span> <span class="op">(</span><span class="va">xs</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">domain</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, upper <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">codomain</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span>y1 <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"minimize"</span><span class="op">)</span>, y2 <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"minimize"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objective</span> <span class="op">=</span> <span class="va"><a href="https://bbotk.mlr-org.com/reference/ObjectiveRFun.html" class="external-link">ObjectiveRFun</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  fun <span class="op">=</span> <span class="va">objective_function</span>,</span>
<span>  domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  codomain <span class="op">=</span> <span class="va">codomain</span><span class="op">)</span></span>
<span></span>
<span><span class="va">instance</span> <span class="op">=</span> <span class="va"><a href="https://bbotk.mlr-org.com/reference/OptimInstanceMultiCrit.html" class="external-link">OptimInstanceMultiCrit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  objective <span class="op">=</span> <span class="va">objective</span>,</span>
<span>  search_space <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gaussian process, EI, DIRECT</span></span>
<span><span class="va">surrogate</span> <span class="op">=</span> <span class="fu"><a href="../reference/srlrn.html">srlrn</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.km"</span>,</span>
<span>  covtype <span class="op">=</span> <span class="st">"matern3_2"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"gen"</span>,</span>
<span>  nugget.stability <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">8</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">acq_function</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqf.html">acqf</a></span><span class="op">(</span><span class="st">"ei"</span><span class="op">)</span></span>
<span><span class="va">acq_optimizer</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqo.html">acqo</a></span><span class="op">(</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"nloptr"</span>, algorithm <span class="op">=</span> <span class="st">"NLOPT_GN_DIRECT_L"</span><span class="op">)</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"stagnation"</span>, threshold <span class="op">=</span> <span class="fl">1e-8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">optimizer</span> <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"mbo"</span>,</span>
<span>  loop_function <span class="op">=</span> <span class="va">bayesopt_parego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2906</span><span class="op">)</span></span>
<span><span class="va">optimizer</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">y1</span>, y <span class="op">=</span> <span class="va">y2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="fu">best</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.statistik.tu-dortmund.de/~olafm/software/emoa/" class="external-link">emoa</a></span><span class="op">)</span></span>
<span><span class="va">anytime_hypervolume</span> <span class="op">=</span> <span class="fu">map_dtr</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">batch_nr</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">bnr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pareto</span> <span class="op">=</span> <span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="fu">best</span><span class="op">(</span>batch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">bnr</span><span class="op">)</span><span class="op">[</span>, <span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="va">cols_y</span>, with <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">dhv</span> <span class="op">=</span> <span class="fu">dominated_hypervolume</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pareto</span><span class="op">)</span>, ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">144</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>batch_nr <span class="op">=</span> <span class="va">bnr</span>, dhv <span class="op">=</span> <span class="va">dhv</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">batch_nr</span>, y <span class="op">=</span> <span class="va">dhv</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">anytime_hypervolume</span><span class="op">[</span><span class="va">batch_nr</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_step</span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"vh"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Batch Nr."</span>, y <span class="op">=</span> <span class="st">"Dominated Hypervolume"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="smsego">SmsEGO<a class="anchor" aria-label="anchor" href="#smsego"></a>
</h4>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">objective_function</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">xs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y1 <span class="op">=</span> <span class="va">xs</span><span class="op">$</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span>, y2 <span class="op">=</span> <span class="op">(</span><span class="va">xs</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">domain</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, upper <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">codomain</span> <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/ps.html" class="external-link">ps</a></span><span class="op">(</span>y1 <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"minimize"</span><span class="op">)</span>, y2 <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/Domain.html" class="external-link">p_dbl</a></span><span class="op">(</span>tags <span class="op">=</span> <span class="st">"minimize"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">objective</span> <span class="op">=</span> <span class="va"><a href="https://bbotk.mlr-org.com/reference/ObjectiveRFun.html" class="external-link">ObjectiveRFun</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  fun <span class="op">=</span> <span class="va">objective_function</span>,</span>
<span>  domain <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  codomain <span class="op">=</span> <span class="va">codomain</span><span class="op">)</span></span>
<span></span>
<span><span class="va">instance</span> <span class="op">=</span> <span class="va"><a href="https://bbotk.mlr-org.com/reference/OptimInstanceMultiCrit.html" class="external-link">OptimInstanceMultiCrit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  objective <span class="op">=</span> <span class="va">objective</span>,</span>
<span>  search_space <span class="op">=</span> <span class="va">domain</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gaussian processes, SmsEGO, DIRECT</span></span>
<span><span class="va">learner_y1</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.km"</span>,</span>
<span>  covtype <span class="op">=</span> <span class="st">"matern3_2"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"gen"</span>,</span>
<span>  nugget.stability <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="op">-</span><span class="fl">8</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">learner_y2</span> <span class="op">=</span> <span class="va">learner_y1</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">surrogate</span> <span class="op">=</span> <span class="fu"><a href="../reference/srlrnc.html">srlrnc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">learner_y1</span>, <span class="va">learner_y2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">acq_function</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqf.html">acqf</a></span><span class="op">(</span><span class="st">"sms_ego"</span><span class="op">)</span></span>
<span><span class="va">acq_optimizer</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqo.html">acqo</a></span><span class="op">(</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"nloptr"</span>, algorithm <span class="op">=</span> <span class="st">"NLOPT_GN_DIRECT_L"</span><span class="op">)</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"stagnation"</span>, threshold <span class="op">=</span> <span class="fl">1e-8</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">optimizer</span> <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"mbo"</span>,</span>
<span>  loop_function <span class="op">=</span> <span class="va">bayesopt_smsego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2906</span><span class="op">)</span></span>
<span><span class="va">optimizer</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">y1</span>, y <span class="op">=</span> <span class="va">y2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="fu">best</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">anytime_hypervolume</span> <span class="op">=</span> <span class="fu">map_dtr</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">batch_nr</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">bnr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pareto</span> <span class="op">=</span> <span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="fu">best</span><span class="op">(</span>batch <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">bnr</span><span class="op">)</span><span class="op">[</span>, <span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="va">cols_y</span>, with <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="va">dhv</span> <span class="op">=</span> <span class="fu">dominated_hypervolume</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pareto</span><span class="op">)</span>, ref <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">144</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>batch_nr <span class="op">=</span> <span class="va">bnr</span>, dhv <span class="op">=</span> <span class="va">dhv</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">batch_nr</span>, y <span class="op">=</span> <span class="va">dhv</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">anytime_hypervolume</span><span class="op">[</span><span class="va">batch_nr</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_step</span><span class="op">(</span>direction <span class="op">=</span> <span class="st">"vh"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Batch Nr."</span>, y <span class="op">=</span> <span class="st">"Dominated Hypervolume"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="single-objective-hpo">Single-Objective HPO<a class="anchor" aria-label="anchor" href="#single-objective-hpo"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com" class="external-link">mlr3</a></span><span class="op">)</span></span>
<span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"wine"</span><span class="op">)</span></span>
<span><span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span>,</span>
<span>  cp <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/to_tune.html" class="external-link">to_tune</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1e-4</span>, upper <span class="op">=</span> <span class="fl">1</span>, logscale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  maxdepth <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/to_tune.html" class="external-link">to_tune</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  minbucket <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/to_tune.html" class="external-link">to_tune</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  minsplit <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/to_tune.html" class="external-link">to_tune</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">resampling</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">measure</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msr</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">instance</span> <span class="op">=</span> <span class="va"><a href="https://mlr3tuning.mlr-org.com/reference/TuningInstanceSingleCrit.html" class="external-link">TuningInstanceSingleCrit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  measure <span class="op">=</span> <span class="va">measure</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gaussian process, EI, FocusSearch</span></span>
<span><span class="va">surrogate</span> <span class="op">=</span> <span class="fu"><a href="../reference/srlrn.html">srlrn</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.km"</span>,</span>
<span>  covtype <span class="op">=</span> <span class="st">"matern3_2"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"gen"</span>,</span>
<span>  nugget.estim <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  jitter <span class="op">=</span> <span class="fl">1e-12</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">acq_function</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqf.html">acqf</a></span><span class="op">(</span><span class="st">"ei"</span><span class="op">)</span></span>
<span><span class="va">acq_optimizer</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqo.html">acqo</a></span><span class="op">(</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"focus_search"</span>, n_points <span class="op">=</span> <span class="fl">100L</span>, maxit <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tuner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3tuning.mlr-org.com/reference/mlr_sugar.html" class="external-link">tnr</a></span><span class="op">(</span><span class="st">"mbo"</span>,</span>
<span>  loop_function <span class="op">=</span> <span class="va">bayesopt_ego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2906</span><span class="op">)</span></span>
<span><span class="va">tuner</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></span>
<span><span class="va">instance</span><span class="op">$</span><span class="va">result</span></span>
<span><span class="va">instance</span><span class="op">$</span><span class="va">archive</span><span class="op">$</span><span class="fu">best</span><span class="op">(</span><span class="op">)</span> <span class="co"># result_function is result_by_surrogate_design</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multi-objective-hpo">Multi-Objective HPO<a class="anchor" aria-label="anchor" href="#multi-objective-hpo"></a>
</h3>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">task</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">tsk</a></span><span class="op">(</span><span class="st">"wine"</span><span class="op">)</span></span>
<span><span class="va">learner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span>,</span>
<span>  cp <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/to_tune.html" class="external-link">to_tune</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1e-4</span>, upper <span class="op">=</span> <span class="fl">1</span>, logscale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  maxdepth <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/to_tune.html" class="external-link">to_tune</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  minbucket <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/to_tune.html" class="external-link">to_tune</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>,</span>
<span>  minsplit <span class="op">=</span> <span class="fu"><a href="https://paradox.mlr-org.com/reference/to_tune.html" class="external-link">to_tune</a></span><span class="op">(</span>lower <span class="op">=</span> <span class="fl">1</span>, upper <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">resampling</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">rsmp</a></span><span class="op">(</span><span class="st">"cv"</span>, folds <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">measures</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">msrs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classif.acc"</span>, <span class="st">"selected_features"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">instance</span> <span class="op">=</span> <span class="va"><a href="https://mlr3tuning.mlr-org.com/reference/TuningInstanceMultiCrit.html" class="external-link">TuningInstanceMultiCrit</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  task <span class="op">=</span> <span class="va">task</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">learner</span>,</span>
<span>  resampling <span class="op">=</span> <span class="va">resampling</span>,</span>
<span>  measures <span class="op">=</span> <span class="va">measures</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span>
<span>  store_models <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># required due to selected features</span></span>
<span></span>
<span><span class="co"># Gaussian process, EI, FocusSearch</span></span>
<span><span class="va">surrogate</span> <span class="op">=</span> <span class="fu"><a href="../reference/srlrn.html">srlrn</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html" class="external-link">lrn</a></span><span class="op">(</span><span class="st">"regr.km"</span>,</span>
<span>  covtype <span class="op">=</span> <span class="st">"matern3_2"</span>,</span>
<span>  optim.method <span class="op">=</span> <span class="st">"gen"</span>,</span>
<span>  nugget.estim <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  jitter <span class="op">=</span> <span class="fl">1e-12</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">acq_function</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqf.html">acqf</a></span><span class="op">(</span><span class="st">"ei"</span><span class="op">)</span></span>
<span><span class="va">acq_optimizer</span> <span class="op">=</span> <span class="fu"><a href="../reference/acqo.html">acqo</a></span><span class="op">(</span><span class="fu"><a href="https://bbotk.mlr-org.com/reference/opt.html" class="external-link">opt</a></span><span class="op">(</span><span class="st">"focus_search"</span>, n_points <span class="op">=</span> <span class="fl">100L</span>, maxit <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  terminator <span class="op">=</span> <span class="fu"><a href="https://bbotk.mlr-org.com/reference/trm.html" class="external-link">trm</a></span><span class="op">(</span><span class="st">"evals"</span>, n_evals <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># result_by_surrogate_design is by default not sensible for ParEGO</span></span>
<span><span class="va">tuner</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3tuning.mlr-org.com/reference/mlr_sugar.html" class="external-link">tnr</a></span><span class="op">(</span><span class="st">"mbo"</span>,</span>
<span>  loop_function <span class="op">=</span> <span class="va">bayesopt_parego</span>,</span>
<span>  surrogate <span class="op">=</span> <span class="va">surrogate</span>,</span>
<span>  acq_function <span class="op">=</span> <span class="va">acq_function</span>,</span>
<span>  acq_optimizer <span class="op">=</span> <span class="va">acq_optimizer</span>,</span>
<span>  result_function <span class="op">=</span> <span class="va">result_by_default</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2906</span><span class="op">)</span></span>
<span><span class="va">tuner</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span><span class="va">instance</span><span class="op">)</span></span>
<span><span class="va">instance</span><span class="op">$</span><span class="va">result</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-mlr3book" class="csl-entry">
Becker, Marc, Martin Binder, Bernd Bischl, Natalie Foss, Lars Kotthoff,
Michel Lang, Florian Pfisterer, et al. 2022. <span>“<span class="nocase">mlr3book</span>.”</span> <a href="https://mlr3book.mlr-org.com" class="external-link">https://mlr3book.mlr-org.com</a>.
</div>
<div id="ref-bischl_2021" class="csl-entry">
Bischl, Bernd, Martin Binder, Michel Lang, Tobias Pielok, Jakob Richter,
Stefan Coors, Janek Thomas, et al. 2021. <span>“Hyperparameter
Optimization: Foundations, Algorithms, Best Practices and Open
Challenges.”</span> <em>arXiv:2107.05847 [Cs, Stat]</em>. <a href="https://arxiv.org/abs/2107.05847" class="external-link">https://arxiv.org/abs/2107.05847</a>.
</div>
<div id="ref-garnett_2022" class="csl-entry">
Garnett, Roman. 2022. <em><span>Bayesian Optimization</span></em>.
Cambridge University Press. <a href="https://bayesoptbook.com/" class="external-link">https://bayesoptbook.com/</a>.
</div>
<div id="ref-jones_1998" class="csl-entry">
Jones, Donald R., Matthias Schonlau, and William J. Welch. 1998.
<span>“Efficient Global Optimization of Expensive Black-Box
Functions.”</span> <em>Journal of Global Optimization</em> 13 (4):
455–92. <a href="https://doi.org/10.1023/A:1008306431147" class="external-link">https://doi.org/10.1023/A:1008306431147</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lennart Schneider, Jakob Richter, Marc Becker, Michel Lang, Bernd Bischl, Martin Binder, Julia Moosbauer, Sebastian Fischer.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
